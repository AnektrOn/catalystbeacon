/* Import Google Fonts - must be at the top */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Rajdhani:wght@300;400;500;600;700&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* Shadcn/UI & Design System Core Colors (HSL) */
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;

    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;

    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;

    /* Primary: Dark Goldenrod #B4833D -> 36 54% 47% */
    --primary: 36 54% 47%;
    --primary-foreground: 210 40% 98%;

    /* Secondary: Coyote #81754B -> 48 27% 40% */
    --secondary: 48 27% 40%;
    --secondary-foreground: 210 40% 98%;

    --muted: 210 40% 96%;
    --muted-foreground: 215.4 16.3% 46.9%;

    --accent: 210 40% 96%;
    --accent-foreground: 222.2 84% 4.9%;

    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;

    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 36 54% 47%;
    /* Dark Goldenrod for focus rings */

    --radius: 0.5rem;

    /* Semantic Colors (HSL) */
    --success: 151 55% 41.5%;
    /* #10b981 */
    --warning: 38 92% 50%;
    /* #f59e0b */
    --error: 0 84% 60%;
    /* #ef4444 */
    --info: 217 91% 60%;
    /* #3b82f6 */

    /* Earth Tone Palette */
    --color-old-lace: #F7F1E1;
    --color-bone: #E3D8C1;
    --color-dark-goldenrod: #B4833D;
    --color-kobicha: #66371B;
    --color-coyote: #81754B;
    --color-earth-green: #3F3F2C;

    /* Earth Tone HSL Values */
    --old-lace: 42 47% 93%;
    /* #F7F1E1 */
    --bone: 42 35% 82%;
    /* #E3D8C1 */
    --dark-goldenrod: 36 54% 47%;
    /* #B4833D */
    --kobicha: 21 59% 25%;
    /* #66371B */
    --coyote: 48 27% 40%;
    /* #81754B */
    --earth-green: 60 11% 22%;
    /* #3F3F2C */

    /* Gradients - These will be dynamically updated by colorPaletteSwitcher */
    --gradient-primary: linear-gradient(135deg, var(--color-primary) 0%, var(--color-kobicha) 100%);
    --gradient-secondary: linear-gradient(135deg, var(--color-secondary) 0%, var(--color-earth-green) 100%);
    --gradient-warm: linear-gradient(135deg, var(--color-old-lace) 0%, var(--color-bone) 100%);
    --gradient-earth: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 50%, var(--color-earth-green) 100%);

    /* Sidebar Dimensions */
    --sidebar-width-collapsed: 80px;
    --sidebar-width-expanded: 240px;
    --sidebar-transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);

    /* Custom Design System Colors (Updated) */
    --color-primary: #B4833D;
    --color-secondary: #81754B;
    --color-success: #10b981;
    --color-warning: #f59e0b;
    --color-error: #ef4444;
    
    /* #region agent log */
    /* Color palette system CSS variables - these should be dynamically updated by colorPaletteSwitcher */
    --bg-primary: var(--color-old-lace);
    --bg-secondary: var(--color-bone);
    --text-primary: var(--color-kobicha);
    --text-secondary: var(--color-coyote);
    /* #endregion */

    /* Glassmorphism Variables */
    --glass-opacity: 0.08;
    --glass-border-opacity: 0.2;
    --glass-blur: 16px;

    /* Font Families */
    --font-family-primary: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    --font-family-heading: 'Space Grotesk', sans-serif;
    --font-family-mono: 'JetBrains Mono', 'Fira Code', monospace;
    
    /* Ethereal Design System Fonts - Serif for elegant typography */
    --font-ethereal-body: 'Cinzel', serif;
    --font-ethereal-heading: 'Cinzel', serif;
    
    /* === ETHEREAL CARD DESIGN SYSTEM (Dynamic Theming Engine) === */
    /* Colors - Dynamically inherited from active color palette */
    --ethereal-cyan: hsl(var(--primary));
    --ethereal-white: hsl(var(--card-foreground));
    --ethereal-violet: hsl(var(--secondary));
    --ethereal-text: hsl(var(--foreground));
    
    /* Glass Backgrounds - Derived from palette card color with opacity */
    --ethereal-bg-glass: hsl(var(--card) / 0.4);
    --ethereal-bg-hover: hsl(var(--card) / 0.6);
    
    /* Borders - Derived from palette border color with opacity */
    /* Base opacity - will be overridden for light mode below */
    --ethereal-border: hsl(var(--border) / 0.3);
    --ethereal-border-hover: hsl(var(--border) / 0.5);
    
    /* Card Shadows - Inner glow uses primary color from active palette */
    /* Base shadows - will be enhanced for light mode below */
    --ethereal-shadow-base: 0 20px 50px rgba(0, 0, 0, 0.5), inset 0 0 80px hsl(var(--primary) / 0.05);
    --ethereal-shadow-hover: 0 20px 60px rgba(0, 0, 0, 0.6), inset 0 0 100px hsl(var(--primary) / 0.08);
    --ethereal-shadow-elevated: 0 30px 70px rgba(0, 0, 0, 0.6), inset 0 0 100px hsl(var(--primary) / 0.08);
    
    /* Card Sizing - Shared across all modes */
    --ethereal-card-padding-small: 24px;
    --ethereal-card-padding-medium: 32px;
    --ethereal-card-padding-large: 40px;
    --ethereal-card-radius: 24px;
    --ethereal-card-radius-small: 20px;
    --ethereal-card-radius-large: 28px;
    
    /* Card Blur - Shared across all modes */
    --ethereal-card-blur: 20px;
    
    /* Ambient Light - Uses primary color from active palette */
    --ethereal-light-color: hsl(var(--primary) / 0.08);
  }

  /* Light Mode Overrides - Stronger borders and deeper shadows for visibility */
  :root:not(.dark) {
    /* Colored borders in light mode to separate glass cards from white background */
    /* Uses primary color for a crisp, visible rim that matches the palette */
    --ethereal-border: hsl(var(--primary) / 0.2);
    --ethereal-border-hover: hsl(var(--primary) / 0.3);
    
    /* Enhanced shadows in light mode for better depth perception */
    --ethereal-shadow-base: 0 20px 50px rgba(0, 0, 0, 0.15), 0 8px 20px rgba(0, 0, 0, 0.1), inset 0 0 80px hsl(var(--primary) / 0.08);
    --ethereal-shadow-hover: 0 20px 60px rgba(0, 0, 0, 0.2), 0 10px 25px rgba(0, 0, 0, 0.12), inset 0 0 100px hsl(var(--primary) / 0.12);
    --ethereal-shadow-elevated: 0 30px 70px rgba(0, 0, 0, 0.25), 0 15px 35px rgba(0, 0, 0, 0.15), inset 0 0 100px hsl(var(--primary) / 0.12);
  }

  /* Dark Mode - Keep original subtle borders and shadows */
  :root.dark {
    --ethereal-border: hsl(var(--border) / 0.3);
    --ethereal-border-hover: hsl(var(--border) / 0.5);
    
    /* Keep original subtle shadows for dark mode */
    --ethereal-shadow-base: 0 20px 50px rgba(0, 0, 0, 0.5), inset 0 0 80px hsl(var(--primary) / 0.05);
    --ethereal-shadow-hover: 0 20px 60px rgba(0, 0, 0, 0.6), inset 0 0 100px hsl(var(--primary) / 0.08);
    --ethereal-shadow-elevated: 0 30px 70px rgba(0, 0, 0, 0.6), inset 0 0 100px hsl(var(--primary) / 0.08);
  }
  
  /* Card Sizing - Shared across all modes */
  :root {
    --ethereal-card-padding-small: 24px;
    --ethereal-card-padding-medium: 32px;
    --ethereal-card-padding-large: 40px;
    --ethereal-card-radius: 24px;
    --ethereal-card-radius-small: 20px;
    --ethereal-card-radius-large: 28px;
    
    /* Card Blur */
    --ethereal-card-blur: 20px;
    
    /* Ambient Light - Uses primary color from active palette */
    --ethereal-light-color: hsl(var(--primary) / 0.08);
  }

  /* Dark mode variables are now set by colorPaletteSwitcher */
  /* The .dark class is used as a selector, but values come from palette variants */
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    background-color: hsl(var(--background));
    color: var(--text-primary);
    font-family: 'Cinzel', serif;
    font-size: 1rem; /* 16px - base lisible */
    line-height: 1.75; /* relaxed line-height */
    font-weight: 400;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    -webkit-font-feature-settings: "kern" 1;
    font-feature-settings: "kern" 1;
    position: relative;
  }
  
  /* Ethereal Noise Texture Overlay */
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
    opacity: 0.04;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.4'/%3E%3C/svg%3E");
    background-repeat: repeat;
    background-size: 200px 200px;
  }
  
  /* ============================================
     HIÉRARCHIE TYPOGRAPHIQUE STRICTE
     Police Cinzel préservée - Amélioration uniquement via taille, poids, couleurs
     ============================================ */
  
  /* Body Text - Cinzel Regular, Couleur muted pour réduire charge cognitive */
  body, p, li, span, div:not([class*="heading"]):not([class*="title"]):not([class*="meta"]) {
    font-family: 'Cinzel', serif !important;
    font-size: 1rem !important; /* 16px - base lisible */
    line-height: 1.75 !important; /* relaxed pour lisibilité */
    font-weight: 400 !important; /* Regular */
    color: hsl(var(--muted-foreground)) !important; /* Gris adouci - réduit charge cognitive */
    text-rendering: optimizeLegibility;
    -webkit-font-feature-settings: "kern" 1;
    font-feature-settings: "kern" 1;
  }
  
  /* H1 - Élégant, UPPERCASE avec tracking raffiné, Bold, Couleur principale, Marges généreuses */
  h1 {
    font-family: 'Cinzel', serif !important;
    font-size: 2.25rem !important; /* 36px - élégant, pas massif */
    line-height: 1.2 !important;
    font-weight: 700 !important; /* Bold - prestance sans exagération */
    letter-spacing: 0.08em !important; /* tracking raffiné pour UPPERCASE élégant */
    text-transform: uppercase !important; /* UPPERCASE pour prestance */
    color: hsl(var(--foreground)) !important; /* Couleur principale (100% visible) */
    margin-top: 2.5rem !important; /* 40px - marge généreuse au-dessus */
    margin-bottom: 1rem !important; /* 16px - petite marge en-dessous */
    text-rendering: optimizeLegibility;
  }
  
  /* H2 - Medium, Bold, Couleur principale, Marges généreuses */
  h2 {
    font-family: 'Cinzel', serif !important;
    font-size: 1.75rem !important; /* 28px */
    line-height: 1.3 !important;
    font-weight: 700 !important; /* Bold */
    letter-spacing: 0 !important;
    color: hsl(var(--foreground)) !important; /* Couleur principale (100% visible) */
    margin-top: 2rem !important; /* 32px - marge généreuse au-dessus */
    margin-bottom: 0.75rem !important; /* 12px - petite marge en-dessous */
    text-rendering: optimizeLegibility;
  }
  
  /* H3 - Medium, SemiBold, Couleur accent/primary pour attirer l'œil */
  h3 {
    font-family: 'Cinzel', serif !important;
    font-size: 1.5rem !important; /* 24px */
    line-height: 1.4 !important;
    font-weight: 600 !important; /* SemiBold */
    letter-spacing: 0 !important;
    color: hsl(var(--primary)) !important; /* Couleur accent/primary - attire l'œil sans grossir */
    margin-top: 1.5rem !important; /* 24px - marge généreuse au-dessus */
    margin-bottom: 0.75rem !important; /* 12px - petite marge en-dessous */
    text-rendering: optimizeLegibility;
  }
  
  /* H4 - Medium, SemiBold, Couleur accent */
  h4 {
    font-family: 'Cinzel', serif !important;
    font-size: 1.375rem !important; /* 22px */
    line-height: 1.4 !important;
    font-weight: 600 !important; /* SemiBold */
    letter-spacing: 0 !important;
    color: hsl(var(--primary)) !important; /* Couleur accent */
    margin-top: 1.25rem !important; /* 20px - marge au-dessus */
    margin-bottom: 0.5rem !important; /* 8px - petite marge en-dessous */
    text-rendering: optimizeLegibility;
  }
  
  /* H5 - Medium-Small, SemiBold */
  h5 {
    font-family: 'Cinzel', serif !important;
    font-size: 1.25rem !important; /* 20px */
    line-height: 1.5 !important;
    font-weight: 600 !important; /* SemiBold */
    letter-spacing: 0 !important;
    color: hsl(var(--foreground)) !important; /* Couleur principale */
    margin-top: 1rem !important; /* 16px - marge au-dessus */
    margin-bottom: 0.5rem !important; /* 8px - petite marge en-dessous */
    text-rendering: optimizeLegibility;
  }
  
  /* H6 - Small heading, SemiBold */
  h6 {
    font-family: 'Cinzel', serif !important;
    font-size: 1.125rem !important; /* 18px */
    line-height: 1.5 !important;
    font-weight: 600 !important; /* SemiBold */
    letter-spacing: 0.05em !important;
    color: hsl(var(--foreground)) !important; /* Couleur principale */
    margin-top: 0.75rem !important; /* 12px - marge au-dessus */
    margin-bottom: 0.5rem !important; /* 8px - petite marge en-dessous */
    text-rendering: optimizeLegibility;
  }
  
  /* Meta-data - Dates, Auteurs, etc. - Cinzel mais petit et uppercase */
  .meta-text, [class*="meta"], time, .text-meta {
    font-family: 'Cinzel', serif !important;
    font-size: 0.75rem !important; /* 12px */
    line-height: 1.5 !important;
    font-weight: 600 !important;
    letter-spacing: 0.1em !important; /* wide tracking */
    text-transform: uppercase !important;
    color: hsl(var(--muted-foreground) / 0.8) !important; /* Gris sombre/muted */
  }
  
  /* Fix for button text rendering - prevent letter spacing issues */
  button, .btn, [role="button"], a.button {
    text-rendering: optimizeLegibility;
    -webkit-font-feature-settings: "kern" 1;
    font-feature-settings: "kern" 1;
    letter-spacing: normal !important;
    word-spacing: normal !important;
    font-kerning: normal;
  }
  
  /* Ensure proper text rendering for links and interactive elements */
  a, button, input, select, textarea {
    text-rendering: optimizeLegibility;
    -webkit-font-feature-settings: "kern" 1;
    font-feature-settings: "kern" 1;
  }

  /* Dark mode text colors are now set by colorPaletteSwitcher */
  
  /* Prose styles pour le contenu de cours (avec @tailwindcss/typography) - Cinzel préservé, Approche Raffinée */
  .prose {
    font-family: 'Cinzel', serif !important;
    color: hsl(var(--muted-foreground)) !important;
  }
  
  .prose h1 {
    font-family: 'Cinzel', serif !important;
    font-size: 2.25rem !important; /* 36px - élégant */
    line-height: 1.2 !important;
    font-weight: 700 !important; /* Bold */
    letter-spacing: 0.08em !important; /* tracking raffiné pour UPPERCASE élégant */
    text-transform: uppercase !important; /* UPPERCASE pour prestance */
    color: hsl(var(--foreground)) !important; /* Couleur principale (100% visible) */
    margin-top: 2.5rem !important; /* 40px - marge généreuse */
    margin-bottom: 1rem !important; /* 16px - petite marge */
  }
  
  .prose h2 {
    font-family: 'Cinzel', serif !important;
    font-size: 1.75rem !important; /* 28px */
    line-height: 1.3 !important;
    font-weight: 700 !important; /* Bold */
    letter-spacing: 0 !important;
    color: hsl(var(--foreground)) !important; /* Couleur principale (100% visible) */
    margin-top: 2rem !important; /* 32px - marge généreuse */
    margin-bottom: 0.75rem !important; /* 12px - petite marge */
  }
  
  .prose h3 {
    font-family: 'Cinzel', serif !important;
    font-size: 1.5rem !important; /* 24px */
    line-height: 1.4 !important;
    font-weight: 600 !important; /* SemiBold */
    letter-spacing: 0 !important;
    color: hsl(var(--primary)) !important; /* Couleur accent - attire l'œil */
    margin-top: 1.5rem !important; /* 24px - marge généreuse */
    margin-bottom: 0.75rem !important; /* 12px - petite marge */
  }
  
  .prose p {
    font-family: 'Cinzel', serif !important;
    font-size: 1rem !important; /* 16px - lisible */
    line-height: 1.75 !important;
    font-weight: 400 !important; /* Regular */
    color: hsl(var(--muted-foreground)) !important; /* Gris adouci - réduit charge cognitive */
    margin-bottom: 1.25rem !important;
  }
  
  .prose ul, .prose ol {
    font-family: 'Cinzel', serif !important;
    font-size: 1rem !important; /* 16px */
    line-height: 1.75 !important;
    color: hsl(var(--muted-foreground)) !important; /* Gris adouci */
    margin-bottom: 1.25rem !important;
  }
  
  .prose li {
    margin-bottom: 0.5rem !important;
  }
  
  .prose strong {
    font-weight: 700 !important; /* Bold pour contraste */
    color: hsl(var(--foreground)) !important; /* Couleur principale */
  }
  
  .prose em {
    font-style: italic !important;
    color: hsl(var(--muted-foreground) / 0.9) !important;
  }

  code {
    font-family: var(--font-family-mono);
  }
}

@layer utilities {
  .text-balance {
    text-wrap: balance;
  }
  
  /* Typography Utility Classes - Cinzel préservé, Approche Raffinée */
  .text-body {
    font-family: 'Rajdhani', serif !important;
    font-size: 1rem !important; /* 16px - lisible */
    line-height: 1.75 !important; /* relaxed */
    font-weight: 400 !important; /* Regular */
    letter-spacing: 0 !important;
    color: hsl(var(--muted-foreground)) !important; /* Gris adouci - réduit charge cognitive */
    
  }
  
  .text-body-sm {
    font-family: 'Rajdhani', serif !important;
    font-size: 0.875rem !important; /* 14px */
    line-height: 1.625 !important;
    font-weight: 400 !important; /* Regular */
    letter-spacing: 0 !important;
    color: hsl(var(--muted-foreground)) !important; /* Gris adouci */
  }
  
  /* Ethereal Noise Texture Utility Class */
  .ethereal-noise {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
    opacity: 0.04;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.4'/%3E%3C/svg%3E");
    background-repeat: repeat;
    background-size: 200px 200px;
  }
}

/* Global Modal Overlay Fix - Ensures all modals appear in viewport */
.modal-overlay,
.complete-lesson-modal__overlay,
.mood-tracker-modal-overlay,
.completion-animation-overlay,
[class*="modal-overlay"],
[class*="modal__overlay"],
[class*="-modal-overlay"] {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  margin: 0 !important;
  padding: 20px !important;
  box-sizing: border-box !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  overflow-y: auto !important;
  z-index: 9999 !important;
  transform: none !important;
}

/* Ensure modal content is centered and scrollable */
.complete-lesson-modal,
.mood-tracker-modal,
.mission-card,
.completion-animation-content,
[class*="modal"]:not([class*="overlay"]):not([class*="header"]):not([class*="body"]):not([class*="footer"]):not([class*="content"]):not([class*="actions"]):not([class*="close"]) {
  max-height: calc(100vh - 40px) !important;
  margin: auto !important;
  position: relative !important;
  transform: none !important;
  top: auto !important;
  left: auto !important;
}

/* Animations */
.animate-fade-in {
  animation: fadeIn 0.4s ease-out forwards;
}

.animate-scale-in {
  animation: scaleIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

.animate-pulse-slow {
  animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes scaleIn {
  from { 
    opacity: 0; 
    transform: scale(0.95); 
  }
  to { 
    opacity: 1; 
    transform: scale(1); 
  }
}

/* Smooth transitions for theme color palette changes */
* {
  transition-property: background-color, border-color, color, fill, stroke;
  transition-timing-function: ease-in-out;
  transition-duration: 500ms;
}

/* Custom Scrollbars - Ethereal Theme */
* {
  scrollbar-width: thin;
  scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
}

*::-webkit-scrollbar {
  width: 4px;
  height: 4px;
}

*::-webkit-scrollbar-track {
  background: transparent;
}

*::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 2px;
}

*::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

  /* Buttons, inputs, and form elements - Cinzel préservé */
  button, input, select, textarea, label, legend {
    font-family: 'Cinzel', serif !important;
    text-rendering: optimizeLegibility;
    -webkit-font-feature-settings: "kern" 1;
    font-feature-settings: "kern" 1;
  }

/* Chart elements - ensure Recharts and SVG text use serif */
svg text, .recharts-legend-item, .recharts-tooltip-label, .recharts-cartesian-axis-tick-value,
.recharts-legend-item-text, .recharts-tooltip-item-label, .recharts-tooltip-item-value {
  font-family: 'Cinzel', serif !important;
}

/* Code elements should still use monospace */
code, pre, kbd, samp {
  font-family: var(--font-family-mono) !important;
}
