/* Fonts: Space Grotesk (UI 95%) + Cinzel (school/lore headers); font-display: swap to avoid invisible text */
@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Space+Grotesk:wght@300;400;500;600;700&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* Raw HSL numbers only (dynamically set by colorPaletteSwitcher) */
    /* Primary base */
    --p-h: 36;
    --p-s: 54%;
    --p-l: 47%;
    --primary: var(--p-h) var(--p-s) var(--p-l);

    /* Shadcn/UI & Design System Core (HSL) - palette switcher sets these */
    --background: 0 0% 100%;
    --foreground: 222.2 84% 4.9%;
    --card: 0 0% 100%;
    --card-foreground: 222.2 84% 4.9%;
    --popover: 0 0% 100%;
    --popover-foreground: 222.2 84% 4.9%;
    --primary-foreground: 210 40% 98%;
    --secondary: 48 27% 40%;
    --secondary-foreground: 210 40% 98%;
    --muted: 210 40% 96%;
    --muted-foreground: 215.4 16.3% 46.9%;
    --accent: 210 40% 96%;
    --accent-foreground: 222.2 84% 4.9%;
    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 210 40% 98%;
    --border: 214.3 31.8% 91.4%;
    --input: 214.3 31.8% 91.4%;
    --ring: 36 54% 47%;
    --radius: 0.5rem;
    --success: 151 55% 41.5%;
    --warning: 38 92% 50%;
    --error: 0 84% 60%;
    --info: 217 91% 60%;

    /* Gradients - HSL-based, no Hex */
    --gradient-primary: linear-gradient(135deg, hsl(var(--primary)) 0%, hsl(var(--foreground)) 100%);
    --gradient-secondary: linear-gradient(135deg, hsl(var(--secondary)) 0%, hsl(var(--muted-foreground)) 100%);
    --gradient-warm: linear-gradient(135deg, hsl(var(--card)) 0%, hsl(var(--muted)) 100%);
    --gradient-earth: linear-gradient(135deg, hsl(var(--primary)) 0%, hsl(var(--secondary)) 50%, hsl(var(--foreground)) 100%);

    /* Sidebar Dimensions */
    --sidebar-width-collapsed: 80px;
    --sidebar-width-expanded: 240px;
    --sidebar-transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-snappy: 150ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-ambient: 1000ms cubic-bezier(0.4, 0, 0.2, 1);

    /* Glassmorphism & performance toggles: set --glass-blur-amount to 0px to disable all blurs globally */
    --glass-opacity: 0.08;
    --glass-border-opacity: 0.2;
    --glass-blur: 12px;
    --glass-blur-amount: var(--glass-blur);
    --particle-display: block;

    /* Font Families - Space Grotesk UI (95%), Cinzel for school/lore headers only */
    --font-family-primary: 'Space Grotesk', -apple-system, BlinkMacSystemFont, sans-serif;
    --font-family-heading: 'Cinzel', serif;
    --font-family-mono: ui-monospace, 'SF Mono', Monaco, monospace;

    /* Ethereal Design System Fonts */
    --font-ethereal-body: 'Space Grotesk', sans-serif;
    --font-ethereal-heading: 'Cinzel', serif;

    /* Atomic primary: built from channels; functional aliases (no manual primary-20, primary-10) */
    --color-primary: hsl(var(--primary));
    --color-primary-glass: hsl(var(--primary) / 0.15);
    --color-primary-border: hsl(var(--primary) / 0.3);

    /* Legacy compat: derived from HSL so components can keep using --bg-primary etc. */
    --bg-primary: hsl(var(--background));
    --bg-secondary: hsl(var(--card));
    --text-primary: hsl(var(--foreground));
    --text-secondary: hsl(var(--muted-foreground));
    
    /* === ETHEREAL CARD DESIGN SYSTEM (Dynamic Theming Engine) === */
    /* Colors - Dynamically inherited from active color palette */
    --ethereal-cyan: hsl(var(--primary));
    --ethereal-white: hsl(var(--card-foreground));
    --ethereal-violet: hsl(var(--secondary));
    --ethereal-text: hsl(var(--foreground));
    
    /* Glass Backgrounds - Derived from palette card color with opacity */
    --ethereal-bg-glass: hsl(var(--card) / 0.4);
    --ethereal-bg-hover: hsl(var(--card) / 0.6);
    
    /* Borders - Derived from palette border color with opacity */
    /* Base opacity - will be overridden for light mode below */
    --ethereal-border: hsl(var(--border) / 0.3);
    --ethereal-border-hover: hsl(var(--border) / 0.5);
    
    /* Card Shadows - Inner glow uses primary color from active palette */
    /* Base shadows - will be enhanced for light mode below */
    --ethereal-shadow-base: 0 20px 50px rgba(0, 0, 0, 0.5), inset 0 0 80px hsl(var(--primary) / 0.05);
    --ethereal-shadow-hover: 0 20px 60px rgba(0, 0, 0, 0.6), inset 0 0 100px hsl(var(--primary) / 0.08);
    --ethereal-shadow-elevated: 0 30px 70px rgba(0, 0, 0, 0.6), inset 0 0 100px hsl(var(--primary) / 0.08);
    
    /* Card Sizing - Shared across all modes */
    --ethereal-card-padding-small: 24px;
    --ethereal-card-padding-medium: 32px;
    --ethereal-card-padding-large: 40px;
    --ethereal-card-radius: 24px;
    --ethereal-card-radius-small: 20px;
    --ethereal-card-radius-large: 28px;
    
    /* Card Blur - Uses global --glass-blur-amount (set to 0 on mobile/low-power) */
    --ethereal-card-blur: var(--glass-blur-amount);
    
    /* Ambient Light - Uses primary color from active palette */
    --ethereal-light-color: hsl(var(--primary) / 0.08);
  }

  /* Light Mode Overrides - Stronger borders and deeper shadows for visibility */
  :root:not(.dark) {
    /* Colored borders in light mode to separate glass cards from white background */
    /* Uses primary color for a crisp, visible rim that matches the palette */
    --ethereal-border: hsl(var(--primary) / 0.2);
    --ethereal-border-hover: hsl(var(--primary) / 0.3);
    
    /* Enhanced shadows in light mode for better depth perception */
    --ethereal-shadow-base: 0 20px 50px rgba(0, 0, 0, 0.15), 0 8px 20px rgba(0, 0, 0, 0.1), inset 0 0 80px hsl(var(--primary) / 0.08);
    --ethereal-shadow-hover: 0 20px 60px rgba(0, 0, 0, 0.2), 0 10px 25px rgba(0, 0, 0, 0.12), inset 0 0 100px hsl(var(--primary) / 0.12);
    --ethereal-shadow-elevated: 0 30px 70px rgba(0, 0, 0, 0.25), 0 15px 35px rgba(0, 0, 0, 0.15), inset 0 0 100px hsl(var(--primary) / 0.12);
  }

  /* Dark Mode - Keep original subtle borders and shadows */
  :root.dark {
    --ethereal-border: hsl(var(--border) / 0.3);
    --ethereal-border-hover: hsl(var(--border) / 0.5);
    
    /* Keep original subtle shadows for dark mode */
    --ethereal-shadow-base: 0 20px 50px rgba(0, 0, 0, 0.5), inset 0 0 80px hsl(var(--primary) / 0.05);
    --ethereal-shadow-hover: 0 20px 60px rgba(0, 0, 0, 0.6), inset 0 0 100px hsl(var(--primary) / 0.08);
    --ethereal-shadow-elevated: 0 30px 70px rgba(0, 0, 0, 0.6), inset 0 0 100px hsl(var(--primary) / 0.08);
  }
  
  /* Card Sizing - Shared across all modes */
  :root {
    --ethereal-card-padding-small: 24px;
    --ethereal-card-padding-medium: 32px;
    --ethereal-card-padding-large: 40px;
    --ethereal-card-radius: 24px;
    --ethereal-card-radius-small: 20px;
    --ethereal-card-radius-large: 28px;
    --ethereal-card-blur: var(--glass-blur-amount);
    --ethereal-light-color: hsl(var(--primary) / 0.08);
  }

  /* Performance: disable blur and particles on mobile / low power */
  @media (max-width: 768px), (prefers-reduced-motion: reduce) {
    :root {
      --glass-blur: 0px;
      --particle-display: none;
    }
  }

  /* Dark mode variables are now set by colorPaletteSwitcher */
  /* The .dark class is used as a selector, but values come from palette variants */
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    background-color: transparent;
    color: hsl(var(--foreground));
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1rem; /* 16px - base lisible */
    line-height: 1.75; /* relaxed line-height */
    font-weight: 400;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    -webkit-font-feature-settings: "kern" 1;
    font-feature-settings: "kern" 1;
    position: relative;
  }
  
  /* Ethereal Noise Texture Overlay */
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
    opacity: 0.04;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.4'/%3E%3C/svg%3E");
    background-repeat: repeat;
    background-size: 200px 200px;
  }
  
  /* ============================================
     HIÉRARCHIE TYPOGRAPHIQUE STRICTE
     Space Grotesk UI (95%), Cinzel for school/lore headers only
     ============================================ */
  
  /* Body Text - Space Grotesk par défaut */
  body, p, li, span:not([class*="text-"]), div:not([class*="font-cinzel"]):not([class*="title"]):not([class*="meta"]):not([class*="text-"]) {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1rem; /* 16px - base lisible */
    line-height: 1.75; /* relaxed pour lisibilité */
    font-weight: 400;
    color: hsl(var(--muted-foreground)); 
    text-rendering: optimizeLegibility;
  }
  
  /* H1 - Cinzel for headings only */
  h1 {
    font-family: 'Cinzel', serif;
    line-height: 1.1;
    font-weight: 600;
    letter-spacing: 0.02em;
    color: hsl(var(--foreground));
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    text-rendering: optimizeLegibility;
  }
  
  /* H2–H6 - Cinzel for headings only */
  h2, h3, h4, h5, h6 {
    font-family: 'Cinzel', serif;
    font-weight: 600;
    color: hsl(var(--foreground));
    text-rendering: optimizeLegibility;
  }

  /* Classes utilitaires spécifiques pour forcer Cinzel */
  .font-cinzel {
    font-family: 'Cinzel', serif !important;
  }

  .font-rajdhani,
  .font-body {
    font-family: 'Space Grotesk', sans-serif !important;
  }
  
  /* Meta-data - Space Grotesk mais petit et uppercase */
  .meta-text, [class*="meta"], time, .text-meta {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 0.75rem;
    line-height: 1.5;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: hsl(var(--muted-foreground) / 0.8);
  }
  
  /* Fix for button text rendering - prevent letter spacing issues */
  button, .btn, [role="button"], a.button {
    text-rendering: optimizeLegibility;
    -webkit-font-feature-settings: "kern" 1;
    font-feature-settings: "kern" 1;
    letter-spacing: normal !important;
    word-spacing: normal !important;
    font-kerning: normal;
  }
  
  /* Ensure proper text rendering for links and interactive elements */
  a, button, input, select, textarea {
    text-rendering: optimizeLegibility;
    -webkit-font-feature-settings: "kern" 1;
    font-feature-settings: "kern" 1;
  }

  /* Dark mode text colors are now set by colorPaletteSwitcher */
  
  /* Prose styles pour le contenu de cours (avec @tailwindcss/typography) - Space Grotesk par défaut */
  .prose {
    font-family: 'Space Grotesk', sans-serif;
    color: hsl(var(--muted-foreground));
  }
  
  .prose h1, .prose h2, .prose h3, .prose h4 {
    font-family: 'Space Grotesk', sans-serif;
    color: hsl(var(--foreground));
  }
  
  .prose p, .prose ul, .prose ol, .prose li {
    font-family: 'Space Grotesk', sans-serif;
  }
  
  .prose strong {
    font-weight: 700 !important; /* Bold pour contraste */
    color: hsl(var(--foreground)) !important; /* Couleur principale */
  }
  
  .prose em {
    font-style: italic !important;
    color: hsl(var(--muted-foreground) / 0.9) !important;
  }

  code {
    font-family: var(--font-family-mono);
  }
}

@layer utilities {
  .text-balance {
    text-wrap: balance;
  }
  
  /* Typography Utility Classes - Cinzel préservé, Approche Raffinée */
  .text-body {
    font-family: 'Space Grotesk', sans-serif !important;
    font-size: 1rem !important; /* 16px - lisible */
    line-height: 1.75 !important; /* relaxed */
    font-weight: 400 !important; /* Regular */
    letter-spacing: 0 !important;
    color: hsl(var(--muted-foreground)) !important; /* Gris adouci - réduit charge cognitive */
    
  }
  
  .text-body-sm {
    font-family: 'Space Grotesk', sans-serif !important;
    font-size: 0.875rem !important; /* 14px */
    line-height: 1.625 !important;
    font-weight: 400 !important; /* Regular */
    letter-spacing: 0 !important;
    color: hsl(var(--muted-foreground)) !important; /* Gris adouci */
  }
  
  /* Ethereal Noise Texture Utility Class */
  .ethereal-noise {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
    opacity: 0.04;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='3' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.4'/%3E%3C/svg%3E");
    background-repeat: repeat;
    background-size: 200px 200px;
  }
}

/* Global Modal Overlay Fix - Ensures all modals appear in viewport */
.modal-overlay,
.complete-lesson-modal__overlay,
.mood-tracker-modal-overlay,
.completion-animation-overlay,
[class*="modal-overlay"],
[class*="modal__overlay"],
[class*="-modal-overlay"] {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  bottom: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  margin: 0 !important;
  padding: 20px !important;
  box-sizing: border-box !important;
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  overflow-y: auto !important;
  z-index: 9999 !important;
  transform: none !important;
}

/* Ensure modal content is centered and scrollable */
.complete-lesson-modal,
.mood-tracker-modal,
.mission-card,
.completion-animation-content,
[class*="modal"]:not([class*="overlay"]):not([class*="header"]):not([class*="body"]):not([class*="footer"]):not([class*="content"]):not([class*="actions"]):not([class*="close"]) {
  max-height: calc(100vh - 40px) !important;
  margin: auto !important;
  position: relative !important;
  transform: none !important;
  top: auto !important;
  left: auto !important;
}

/* Animations */
.animate-fade-in {
  animation: fadeIn 0.4s ease-out forwards;
}

.animate-scale-in {
  animation: scaleIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

.animate-pulse-slow {
  animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes scaleIn {
  from { 
    opacity: 0; 
    transform: scale(0.95); 
  }
  to { 
    opacity: 1; 
    transform: scale(1); 
  }
}

/* Scoped transitions only for interactive elements (no global * transition) */
button,
a,
.clickable,
[role="button"] {
  transition: transform var(--transition-snappy), opacity var(--transition-snappy);
}

/* Utility intent classes: apply only where needed */
.transition-snappy {
  transition: box-shadow var(--transition-snappy), border-color var(--transition-snappy),
    background var(--transition-snappy), transform var(--transition-snappy),
    opacity var(--transition-snappy);
}
.transition-ambient {
  transition: background var(--transition-ambient), box-shadow var(--transition-ambient),
    border-color var(--transition-ambient);
}

/* Custom Scrollbars - Ethereal Theme */
* {
  scrollbar-width: thin;
  scrollbar-color: rgba(255, 255, 255, 0.2) transparent;
}

*::-webkit-scrollbar {
  width: 4px;
  height: 4px;
}

*::-webkit-scrollbar-track {
  background: transparent;
}

*::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 2px;
}

*::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 255, 255, 0.3);
}

  /* Buttons, inputs, and form elements - Space Grotesk */
  button, input, select, textarea, label, legend {
    font-family: 'Space Grotesk', sans-serif !important;
    text-rendering: optimizeLegibility;
  }

/* Chart elements - ensure Recharts and SVG text use serif */
svg text, .recharts-legend-item, .recharts-tooltip-label, .recharts-cartesian-axis-tick-value,
.recharts-legend-item-text, .recharts-tooltip-item-label, .recharts-tooltip-item-value {
  font-family: 'Cinzel', serif !important;
}

/* Code elements should still use monospace */
code, pre, kbd, samp {
  font-family: var(--font-family-mono) !important;
}
